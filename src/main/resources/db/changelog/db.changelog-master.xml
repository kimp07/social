<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <!-- TABLE roles -->
    <changeSet id="2021-05-06_8-00AM-04" author="alex">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="roles"/>
            </not>
        </preConditions>
        <createTable tableName="roles">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="roles_pk"/>
            </column>
            <column name="role_name" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="role_disabled" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE roles -->
    <!-- TABLE users -->
    <changeSet author="alex" id="2021-05-06_8-00AM-11">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>
        <createTable tableName="users">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="users_pk"/>
            </column>
            <column name="user_login" type="VARCHAR(50)">
                <constraints nullable="false" unique="true" uniqueConstraintName="users_user_login_unique"/>
            </column>
            <column name="user_password" type="VARCHAR(512)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(100)">
                <constraints nullable="false" unique="true" uniqueConstraintName="users_email_unique"/>
            </column>
            <column name="u_enabled" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="u_non_locked" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="u_non_expired" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="u_credentials_non_expired" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="users_role_fk"
                             referencedTableName="roles" referencedColumnNames="id"/>
            </column>
            <column name="auth_provider" type="VARCHAR(20)"/>
            <column name="auth_provider_id" type="VARCHAR(200)"/>
            <column name="first_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="surname" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="birth_date" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="about_me" type="VARCHAR(255)"/>
            <column name="user_image_file_name" type="VARCHAR(100)"/>
        </createTable>
    </changeSet><!-- //TABLE users -->
    <!-- TABLE users INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-11-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="users_login_idx" tableName="users"/>
            </not>
        </preConditions>
        <createIndex indexName="users_login_idx" tableName="users">
            <column name="user_login"/>
        </createIndex>
    </changeSet>
    <changeSet author="alex" id="2021-05-06_8-00AM-11-02">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="users_email_idx" tableName="users"/>
            </not>
        </preConditions>
        <createIndex indexName="users_email_idx" tableName="users">
            <column name="email"/>
        </createIndex>
    </changeSet>
    <changeSet author="alex" id="2021-05-06_8-00AM-11-03">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="users_first_name_idx" tableName="users"/>
            </not>
        </preConditions>
        <createIndex indexName="users_first_name_idx" tableName="users">
            <column name="first_name"/>
        </createIndex>
    </changeSet>
    <changeSet author="alex" id="2021-05-06_8-00AM-11-04">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="users_surname_idx" tableName="users"/>
            </not>
        </preConditions>
        <createIndex indexName="users_surname_idx" tableName="users">
            <column name="surname"/>
        </createIndex>
    </changeSet> <!-- //TABLE users INDEXES -->
    <!-- TABLE friendships -->
    <changeSet author="alex" id="2021-05-06_8-00AM-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="friendships"/>
            </not>
        </preConditions>
        <createTable tableName="friendships">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="friendships_pk"/>
            </column>
        </createTable>
    </changeSet> <!-- //TABLE friendships -->
    <!-- TABLE friendship_members -->
    <changeSet author="alex" id="2021-05-06_8-00AM-02">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="friendship_members"/>
            </not>
        </preConditions>
        <createTable tableName="friendship_members">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="friendship_members_pk"/>
            </column>
            <column name="friendship_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="friendship_members_friendship_fk"
                             referencedTableName="friendships" referencedColumnNames="id"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="friendship_members_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet>  <!-- //TABLE friendship_members -->
    <!-- TABLE friendship_members INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-02-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="friendship_members_user_idx" tableName="friendship_members"/>
            </not>
        </preConditions>
        <createIndex indexName="friendship_members_user_idx" tableName="friendship_members">
            <column name="user_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE friendship_members INDEXES -->
    <!-- TABLE friendship_requests -->
    <changeSet author="alex" id="2021-05-06_8-00AM-03">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="friendship_requests"/>
            </not>
        </preConditions>
        <createTable tableName="friendship_requests">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="friendship_requests_pk"/>
            </column>
            <column name="request_date_time" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="sender_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="friendship_requests_sender_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
            <column name="recipient_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="friendship_requests_recipient_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE friendship_requests -->
    <!-- TABLE friendship_requests INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-03-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="friendship_requests_recipient_idx" tableName="friendship_requests"/>
            </not>
        </preConditions>
        <createIndex indexName="friendship_requests_recipient_idx" tableName="friendship_requests">
            <column name="sender_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="alex" id="2021-05-06_8-00AM-03-02">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="friendship_requests_sender_idx" tableName="friendship_requests"/>
            </not>
        </preConditions>
        <createIndex indexName="friendship_requests_sender_idx" tableName="friendship_requests">
            <column name="recipient_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE friendship_requests INDEXES -->
    <!-- TABLE societies -->
    <changeSet author="alex" id="2021-05-06_8-00AM-05">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="societies"/>
            </not>
        </preConditions>
        <createTable tableName="societies">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="societies_pk"/>
            </column>
            <column name="title" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="owner_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="societies_owner_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE societies -->
    <!-- TABLE societies INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-05-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="societies_title_idx" tableName="societies"/>
            </not>
        </preConditions>
        <createIndex indexName="societies_title_idx" tableName="societies">
            <column name="title"/>
        </createIndex>
    </changeSet>
    <changeSet author="alex" id="2021-05-06_8-00AM-05-02">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="societies_owner_idx" tableName="societies"/>
            </not>
        </preConditions>
        <createIndex indexName="societies_owner_idx" tableName="societies">
            <column name="owner_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE societies INDEXES -->
    <!-- TABLE society_members -->
    <changeSet author="alex" id="2021-05-06_8-00AM-06">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="society_members"/>
            </not>
        </preConditions>
        <createTable tableName="society_members">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="society_members_pk"/>
            </column>
            <column name="society_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="society_members_society_fk"
                             referencedTableName="societies" referencedColumnNames="id"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="society_members_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE society_members -->
    <!-- TABLE society_members INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-06-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="society_members_society_idx" tableName="society_members"/>
            </not>
        </preConditions>
        <createIndex indexName="society_members_society_idx" tableName="society_members">
            <column name="society_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="alex" id="2021-05-06_8-00AM-06-02">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="society_members_user_idx" tableName="society_members"/>
            </not>
        </preConditions>
        <createIndex indexName="society_members_user_idx" tableName="society_members">
            <column name="user_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE society_members INDEXES -->
    <!-- TABLE talks -->
    <changeSet author="alex" id="2021-05-06_8-00AM-07">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="talks"/>
            </not>
        </preConditions>
        <createTable tableName="talks">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="talks_pk"/>
            </column>
            <column name="owner_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="talks_owner_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE talks -->
    <!-- TABLE talks INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-07-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="talks_owner_idx" tableName="talks"/>
            </not>
        </preConditions>
        <createIndex indexName="talks_owner_idx" tableName="talks">
            <column name="owner_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE talks INDEXES -->
    <!-- TABLE talk_members -->
    <changeSet author="alex" id="2021-05-06_8-00AM-08">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="talk_members"/>
            </not>
        </preConditions>
        <createTable tableName="talk_members">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="talk_members_pk"/>
            </column>
            <column name="talk_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="talk_members_talk_fk"
                             referencedTableName="talks" referencedColumnNames="id"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="talk_members_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE talk_members -->
    <!-- TABLE talk_members INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-08-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="talk_members_user_idx" tableName="talk_members"/>
            </not>
        </preConditions>
        <createIndex indexName="talk_members_user_idx" tableName="talk_members">
            <column name="user_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE talk_members INDEXES -->
    <!-- TABLE talk_messages -->
    <changeSet author="alex" id="2021-05-06_8-00AM-09">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="talk_messages"/>
            </not>
        </preConditions>
        <createTable tableName="talk_messages">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="talk_messages_pk"/>
            </column>
            <column name="talk_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="talk_messages_talk_fk"
                             referencedTableName="talks" referencedColumnNames="id"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="talk_messages_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
            <column name="message_date" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE talk_messages -->
    <!-- TABLE talk_messages INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-09-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="talk_messages_user_idx" tableName="talk_messages"/>
            </not>
        </preConditions>
        <createIndex indexName="talk_messages_user_idx" tableName="talk_messages">
            <column name="user_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE talk_messages INDEXES -->
    <!-- TABLE talk_messages_cache -->
    <changeSet author="alex" id="2021-05-06_8-00AM-10">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="talk_messages_cache"/>
            </not>
        </preConditions>
        <createTable tableName="talk_messages_cache">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="talk_messages_cache_pk"/>
            </column>
            <column name="talk_message_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="talk_messages_cache_talk_message_fk"
                             referencedTableName="talk_messages" referencedColumnNames="id"/>
            </column>
            <column name="recipient_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="friendship_requests_recipient_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE talk_messages_cache -->
    <!-- TABLE talk_messages_cache INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-10-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="talk_messages_cache_recipient_idx" tableName="talk_messages_cache"/>
            </not>
        </preConditions>
        <createIndex indexName="talk_messages_cache_recipient_idx" tableName="talk_messages_cache">
            <column name="recipient_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE talk_messages_cache INDEXES -->
    <!-- TABLE walls -->
    <changeSet author="alex" id="2021-05-06_8-00AM-12">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="walls"/>
            </not>
        </preConditions>
        <createTable tableName="walls">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="walls_pk"/>
            </column>
            <column name="root_wall" type="BOOLEAN" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="society_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="walls_society_fk"
                             referencedTableName="societies" referencedColumnNames="id"
                             uniqueConstraintName="walls_society_unique" unique="true"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE walls -->
    <!-- TABLE wall_messages -->
    <changeSet author="alex" id="2021-05-06_8-00AM-13">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="wall_messages"/>
            </not>
        </preConditions>
        <createTable tableName="wall_messages">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="wall_messages_pk"/>
            </column>
            <column name="message_date" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="wall_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="wall_messages_wall_fk"
                             referencedTableName="walls" referencedColumnNames="id"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="wall_messages_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
            <column name="message" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="likes_count" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="dislikes_count" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE wall_messages -->
    <!-- TABLE wall_messages INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-13-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="wall_messages_wall_idx" tableName="wall_messages"/>
            </not>
        </preConditions>
        <createIndex indexName="wall_messages_wall_idx" tableName="wall_messages">
            <column name="wall_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE wall_messages INDEXES -->
    <!-- TABLE wall_message_comments -->
    <changeSet author="alex" id="2021-05-06_8-00AM-14">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="wall_message_comments"/>
            </not>
        </preConditions>
        <createTable tableName="wall_message_comments">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="wall_message_comments_pk"/>
            </column>
            <column name="wall_message_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="wall_message_comments_wall_message_fk"
                             referencedTableName="wall_messages" referencedColumnNames="id"/>
            </column>
            <column name="message_date" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="wall_message_comments_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
            <column name="message" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="likes_count" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>s
            </column>
            <column name="dislikes_count" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet><!-- //TABLE wall_message_comments -->
    <!-- TABLE wall_message_comments INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-14-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="wall_message_comments_wall_message_idx" tableName="wall_message_comments"/>
            </not>
        </preConditions>
        <createIndex indexName="wall_message_comments_wall_message_idx" tableName="wall_message_comments">
            <column name="wall_message_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE wall_message_comments INDEXES -->
    <changeSet id="2021-05-06_8-00AM-15" author="Alex">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_images"/>
            </not>
        </preConditions>
        <!-- TABLE user_images -->
        <createTable tableName="user_images">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="user_images_pk"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="user_images_user_fk"
                             referencedTableName="users" referencedColumnNames="id"/>
            </column>
            <column name="img_file_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet> <!-- //TABLE user_images -->
    <!-- TABLE user_images INDEXES-->
    <changeSet author="alex" id="2021-05-06_8-00AM-15-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="user_images_user_id_idx" tableName="user_images"/>
            </not>
        </preConditions>
        <createIndex indexName="user_images_user_id_idx" tableName="user_images">
            <column name="user_id"/>
        </createIndex>
    </changeSet> <!-- //TABLE user_images INDEXES -->
    <!-- SYSTEM DATA -->
    <changeSet id="" author="2021-05-06_8-00AM-16">
        <insert tableName="roles">
            <column name="role_name">USER</column>
            <column name="role_disabled">false</column>
        </insert>
        <insert tableName="users">
            <column name="user_login">root</column>
            <column name="user_password">$2a$10$4aKf2PGp6pFCvlHFdX6ys.frNxwJyC1EIYdwfE3xSVnIrO1hIQaNW</column>
            <column name="email">root@social.net</column>
            <column name="first_name">root</column>
            <column name="surname">root</column>
            <column name="about_me">"root"</column>
            <column name="birth_date">2021-05-06</column>
            <column name="role_id">1</column>
            <column name="u_credentials_non_expired">true</column>
            <column name="u_enabled">true</column>
            <column name="u_non_expired">true</column>
            <column name="u_non_locked">true</column>
        </insert>
        <insert tableName="societies">
            <column name="title">root society</column>
            <column name="owner_id">1</column>
        </insert>
        <insert tableName="walls">
            <column name="root_wall">true</column>
            <column name="society_id">1</column>
        </insert>
    </changeSet>
</databaseChangeLog>